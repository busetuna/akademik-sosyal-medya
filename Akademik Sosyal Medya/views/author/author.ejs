<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Enhanced Compare</title>
  <link rel="stylesheet" href="/css/partials/navbar.css">
  <link rel="stylesheet" href="/css/author/author.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Checkbox ve label i√ßin g√ºzel g√∂r√ºn√ºm ve tƒ±klanabilirlik */
    .article-title {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      cursor: pointer;
    }
    .article-title input[type="checkbox"] {
      margin-top: 5px;
      cursor: pointer;
      transform: scale(1.2);
    }
    .article-title input[type="checkbox"]:checked {
      accent-color: #667eea;
    }

    /* Selected articles counter */
    .selection-counter {
      position: sticky;
      top: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
    }

    .selection-counter.has-selection {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .selected-articles-preview {
      margin-top: 10px;
      max-height: 100px;
      overflow-y: auto;
      font-size: 12px;
      opacity: 0.9;
    }

    .selected-article-item {
      background: rgba(255,255,255,0.2);
      margin: 2px 0;
      padding: 4px 8px;
      border-radius: 4px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    /* Compare b√∂l√ºm√º stil - geli≈ütirilmi≈ü */
    #compareSection {
      margin-top: 40px;
      padding: 25px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px;
      border: 1px solid #dee2e6;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    #compareSection h3 {
      margin-bottom: 20px;
      color: #495057;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #myAbstractInput {
      width: 100%;
      min-height: 120px;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #ced4da;
      resize: vertical;
      font-size: 14px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin-bottom: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
    }

    #myAbstractInput:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    #compareBtn {
      padding: 12px 25px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #compareBtn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    #compareBtn:disabled {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #compareResult {
      margin-top: 25px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      border: 1px solid #dee2e6;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.6;
      display: none;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .compare-result-loading {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      color: #1976d2;
      text-align: center;
      font-style: italic;
    }

    .compare-result-success {
      background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
      color: #2e7d32;
      border-left: 5px solid #4caf50;
    }

    .compare-result-error {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      color: #c62828;
      border-left: 5px solid #f44336;
    }

    /* Selection actions */
    .selection-actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-secondary {
      padding: 8px 16px;
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }

    /* Article row highlighting when selected */
    .article-row.selected {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      border-left: 4px solid #667eea;
      padding-left: 16px;
      margin-left: -4px;
      border-radius: 8px;
    }

    /* No articles message */
    .no-articles {
      text-align: center;
      padding: 40px;
      color: #6c757d;
      font-style: italic;
    }

    /* Load more button */
    .load-more-btn {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .load-more-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    .load-more-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }

    /* Demo styles - normalde CSS dosyalarƒ±ndan gelir */
    .author-page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .author-layout {
      display: flex;
      gap: 30px;
    }

    .author-left {
      flex: 2;
    }

    .author-right {
      flex: 1;
    }

    .author-header {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .author-photo img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }

    .author-info h2 {
      margin: 0 0 10px 0;
      color: #333;
    }

    .author-info p {
      margin: 5px 0;
      color: #666;
    }

    .author-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }

    .author-tags span {
      background: #f0f0f0;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .article-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .article-row {
      display: grid;
      grid-template-columns: 3fr 1fr 1fr;
      gap: 20px;
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
    }

    .article-header {
      background: #f8f9fa;
      font-weight: bold;
      color: #495057;
    }

    .article-meta {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .journal {
      font-style: italic;
    }

    .citation-box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .citation-box h4 {
      margin: 0 0 15px 0;
      color: #333;
    }

    .citation-box table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .citation-box th,
    .citation-box td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .citation-box th {
      background: #f8f9fa;
      font-weight: bold;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .author-layout {
        flex-direction: column;
      }
      
      .selection-actions {
        flex-direction: column;
      }
      
      .selection-counter {
        position: relative;
      }

      .article-row {
        grid-template-columns: 2fr 1fr 1fr;
        gap: 10px;
        padding: 10px;
      }
    }
  </style>
</head>

<body>
  <!-- Navbar include burada olacak -->
  <!-- <%- include('../partials/navbar') %> -->

  <div class="author-page">
    <!-- Yazar Bilgileri ve Alƒ±ntƒ± Kutusu -->
    <div class="author-layout">
      <!-- Sol: Yazar bilgileri ve makaleler -->
      <div class="author-left">
        <!-- Selection Counter -->
        <div class="selection-counter" id="selectionCounter">
          <div>üìä <span id="selectedCount">0</span> makale se√ßildi</div>
          <div class="selected-articles-preview" id="selectedPreview"></div>
          <div class="selection-actions">
            <button class="btn-secondary" onclick="selectAll()">üîò T√ºm√ºn√º Se√ß</button>
            <button class="btn-secondary" onclick="deselectAll()">‚≠ï T√ºm√ºn√º Kaldƒ±r</button>
            <button class="btn-secondary" onclick="selectTop(5)">üîù ƒ∞lk 5'i Se√ß</button>
            <button class="btn-secondary" onclick="selectByCitation(10)">üìà En √áok Atƒ±f Alan 10</button>
          </div>
        </div>

        <!-- Author Header - Demo Data -->
        <div class="author-header">
          <div class="author-photo">
            <img src="https://via.placeholder.com/80?text=üë§" alt="Yazar Fotoƒürafƒ±">
          </div>
          <div class="author-info">
            <h2>Dr. √ñrnek Yazar</h2>
            <p>√úniversite Adƒ± - B√∂l√ºm</p>
            <p>ornek@universite.edu.tr</p>
            <div class="author-tags">
              <span>Machine Learning</span>
              <span>Data Science</span>
              <span>AI</span>
            </div>
          </div>
        </div>

        <!-- Makale listesi - Demo Data -->
        <div class="article-list">
          <div class="article-table">
            <div class="article-row article-header">
              <div class="article-title">SE√á / BA≈ûLIK</div>
              <div class="article-cited">ALINTI YAPANLAR</div>
              <div class="article-year">YIL</div>
            </div>

            <!-- Demo Articles -->
            <div class="article-row" data-article-index="0">
              <div class="article-title">
                <input
                  type="checkbox"
                  class="compare-checkbox"
                  id="chk-0"
                  data-abstract="Bu makale makine √∂ƒürenmesi algoritmalarƒ±nƒ±n performansƒ±nƒ± kar≈üƒ±la≈ütƒ±rmaktadƒ±r."
                  data-title="Machine Learning Algoritmalarƒ± Kar≈üƒ±la≈ütƒ±rmasƒ±"
                >
                <label for="chk-0">
                  <a href="#" target="_blank">Machine Learning Algoritmalarƒ± Kar≈üƒ±la≈ütƒ±rmasƒ±</a>
                  <div class="article-meta">
                    Dr. √ñrnek Yazar, Dr. ƒ∞kinci Yazar<br>
                    <span class="journal">Journal of Computer Science</span>
                  </div>
                </label>
              </div>
              <div class="article-cited">42</div>
              <div class="article-year">2023</div>
            </div>

            <div class="article-row" data-article-index="1">
              <div class="article-title">
                <input
                  type="checkbox"
                  class="compare-checkbox"
                  id="chk-1"
                  data-abstract="Bu √ßalƒ±≈üma derin √∂ƒürenme modellerinin optimizasyonu √ºzerine odaklanmaktadƒ±r."
                  data-title="Derin √ñƒürenme Modellerinin Optimizasyonu"
                >
                <label for="chk-1">
                  <a href="#" target="_blank">Derin √ñƒürenme Modellerinin Optimizasyonu</a>
                  <div class="article-meta">
                    Dr. √ñrnek Yazar<br>
                    <span class="journal">Neural Networks Journal</span>
                  </div>
                </label>
              </div>
              <div class="article-cited">28</div>
              <div class="article-year">2022</div>
            </div>

            <div class="article-row" data-article-index="2">
              <div class="article-title">
                <input
                  type="checkbox"
                  class="compare-checkbox"
                  id="chk-2"
                  data-abstract="Bu ara≈ütƒ±rma veri madenciliƒüi tekniklerini incelemektedir."
                  data-title="Veri Madenciliƒüi Teknikleri √úzerine Bir ƒ∞nceleme"
                >
                <label for="chk-2">
                  <a href="#" target="_blank">Veri Madenciliƒüi Teknikleri √úzerine Bir ƒ∞nceleme</a>
                  <div class="article-meta">
                    Dr. √ñrnek Yazar, Prof. Dr. √ú√ß√ºnc√º Yazar<br>
                    <span class="journal">Data Mining Review</span>
                  </div>
                </label>
              </div>
              <div class="article-cited">15</div>
              <div class="article-year">2021</div>
            </div>
          </div>
        </div>

        <!-- Abstract Kar≈üƒ±la≈ütƒ±rma B√∂l√ºm√º -->
        <div id="compareSection">
          <h3>
            <span>üìä</span>
            <span>Se√ßilen Makalelerle Abstract Kar≈üƒ±la≈ütƒ±r</span>
            <span id="compareCounter" style="font-size: 0.8em; color: #6c757d;">(0 makale se√ßili)</span>
          </h3>
          
          <div style="margin-bottom: 15px;">
            <label for="myAbstractInput" style="display: block; margin-bottom: 8px; font-weight: bold; color: #495057;">
              üéØ Kendi Makalenizin Abstract'ƒ±:
            </label>
            <textarea 
              id="myAbstractInput" 
              placeholder="Kendi makalenizin √∂zetini buraya yazƒ±n..." 
              rows="5"
            ></textarea>
          </div>

          <button id="compareBtn">
            <span>üöÄ</span>
            <span>Kar≈üƒ±la≈ütƒ±r</span>
          </button>
          
          <div id="compareResult"></div>
        </div>
      </div>

      <!-- Saƒü: Alƒ±ntƒ± Kutusu -->
      <div class="author-right">
        <div class="citation-box">
          <h4>Alƒ±ntƒ± Yapanlar</h4>
          <table>
            <thead>
              <tr>
                <th></th>
                <th>Hepsi</th>
                <th>2020+</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Alƒ±ntƒ±lar</td>
                <td>85</td>
                <td>62</td>
              </tr>
              <tr>
                <td>h-endeksi</td>
                <td>3</td>
                <td>3</td>
              </tr>
              <tr>
                <td>i10-endeksi</td>
                <td>0</td>
                <td>0</td>
              </tr>
            </tbody>
          </table>

          <!-- Citation Chart -->
          <canvas id="citationChart" width="100%" height="100"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Chart.js initialization with demo data
    const citationChartElem = document.getElementById('citationChart');
    if (citationChartElem) {
      const ctx = citationChartElem.getContext('2d');
      const chartData = {
        labels: ['2019', '2020', '2021', '2022', '2023', '2024'],
        data: [5, 12, 15, 28, 20, 5]
      };

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: chartData.labels,
          datasets: [{
            label: 'Alƒ±ntƒ± Sayƒ±sƒ±',
            data: chartData.data,
            backgroundColor: '#adb5bd'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: Math.max(1, Math.max(...chartData.data) / 5) }
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    // Selection management
    let selectedArticles = new Set();

    function updateSelectionCounter() {
      const count = selectedArticles.size;
      const counter = document.getElementById('selectionCounter');
      const selectedCount = document.getElementById('selectedCount');
      const selectedPreview = document.getElementById('selectedPreview');
      const compareCounter = document.getElementById('compareCounter');
      
      if (selectedCount) selectedCount.textContent = count;
      if (compareCounter) compareCounter.textContent = `(${count} makale se√ßili)`;
      
      if (count > 0) {
        counter?.classList.add('has-selection');
        
        // Show preview of selected articles
        if (selectedPreview) {
          const previewHtml = Array.from(selectedArticles).slice(0, 3).map(title => 
            `<div class="selected-article-item">${escapeHtml(title)}</div>`
          ).join('');
          
          selectedPreview.innerHTML = previewHtml + 
            (selectedArticles.size > 3 ? `<div class="selected-article-item">... ve ${selectedArticles.size - 3} tane daha</div>` : '');
        }
      } else {
        counter?.classList.remove('has-selection');
        if (selectedPreview) selectedPreview.innerHTML = '';
      }
    }

    // HTML escape utility
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Checkbox event listeners
    document.addEventListener('change', function(e) {
      if (e.target.classList.contains('compare-checkbox')) {
        const row = e.target.closest('.article-row');
        const title = e.target.dataset.title;
        
        if (e.target.checked && title) {
          selectedArticles.add(title);
          row?.classList.add('selected');
        } else if (title) {
          selectedArticles.delete(title);
          row?.classList.remove('selected');
        }
        
        updateSelectionCounter();
      }
    });

    // Selection helper functions
    function selectAll() {
      document.querySelectorAll('.compare-checkbox').forEach(cb => {
        if (!cb.disabled && cb.dataset.title) {
          cb.checked = true;
          selectedArticles.add(cb.dataset.title);
          cb.closest('.article-row')?.classList.add('selected');
        }
      });
      updateSelectionCounter();
    }

    function deselectAll() {
      document.querySelectorAll('.compare-checkbox').forEach(cb => {
        cb.checked = false;
        cb.closest('.article-row')?.classList.remove('selected');
      });
      selectedArticles.clear();
      updateSelectionCounter();
    }

    function selectTop(n) {
      deselectAll();
      const checkboxes = Array.from(document.querySelectorAll('.compare-checkbox')).slice(0, n);
      checkboxes.forEach(cb => {
        if (!cb.disabled && cb.dataset.title) {
          cb.checked = true;
          selectedArticles.add(cb.dataset.title);
          cb.closest('.article-row')?.classList.add('selected');
        }
      });
      updateSelectionCounter();
    }

    function selectByCitation(n) {
      deselectAll();
      const articles = Array.from(document.querySelectorAll('.article-row:not(.article-header)'));
      articles.sort((a, b) => {
        const citedA = parseInt(a.querySelector('.article-cited')?.textContent) || 0;
        const citedB = parseInt(b.querySelector('.article-cited')?.textContent) || 0;
        return citedB - citedA;
      });
      
      articles.slice(0, n).forEach(row => {
        const cb = row.querySelector('.compare-checkbox');
        if (cb && !cb.disabled && cb.dataset.title) {
          cb.checked = true;
          selectedArticles.add(cb.dataset.title);
          row.classList.add('selected');
        }
      });
      updateSelectionCounter();
    }

    // Load more articles function (demo - normalde backend'den veri gelir)
    async function loadMoreArticles() {
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      if (!loadMoreBtn) return;
      
      loadMoreBtn.disabled = true;
      loadMoreBtn.textContent = '‚è≥ Y√ºkleniyor...';
      
      try {
        // Demo: Ger√ßek uygulamada burada fetch isteƒüi yapƒ±lƒ±r
        setTimeout(() => {
          loadMoreBtn.style.display = 'none';
        }, 1000);
        
      } catch (error) {
        console.error('Makale y√ºkleme hatasƒ±:', error);
        loadMoreBtn.textContent = '‚ùå Hata olu≈ütu';
        setTimeout(() => {
          loadMoreBtn.disabled = false;
          loadMoreBtn.textContent = 'üìö Daha Fazla Makale Y√ºkle';
        }, 3000);
      }
    }
// Compare functionality
  const compareBtn = document.getElementById('compareBtn');

  if (compareBtn) {
    compareBtn.addEventListener('click', async () => {
      const myAbstractInput = document.getElementById('myAbstractInput');
      const myAbstract = myAbstractInput?.value.trim() || '';

      const checkedBoxes = Array.from(document.querySelectorAll('.compare-checkbox:checked'));
      const compareAbstracts = checkedBoxes
        .map(cb => cb.dataset.abstract?.trim() || '')
        .filter(abs => abs.length > 0);

      const resultDiv = document.getElementById('compareResult');

      if (!myAbstract || compareAbstracts.length === 0) {
        if (resultDiv) {
          resultDiv.style.display = 'block';
          resultDiv.className = 'compare-result-error';
          resultDiv.textContent = '‚ùå L√ºtfen kendi abstract\'ƒ±nƒ±zƒ± yazƒ±n ve en az bir makale se√ßin.';
        }
        return;
      }

      // Y√ºkleme durumu
      compareBtn.disabled = true;
      compareBtn.innerHTML = '<span>‚è≥</span><span>Kar≈üƒ±la≈ütƒ±rƒ±lƒ±yor...</span>';
      if (resultDiv) {
        resultDiv.style.display = 'block';
        resultDiv.className = 'compare-result-loading';
        resultDiv.textContent = 'ü§ñ AI ile kar≈üƒ±la≈ütƒ±rma yapƒ±lƒ±yor, l√ºtfen bekleyin...\n\nBu i≈ülem 30-60 saniye s√ºrebilir.';
      }

      try {
        const response = await fetch('/compare-abstracts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ myAbstract, compareAbstracts })
        });

        const data = await response.json();

        if (resultDiv) {
          resultDiv.className = 'compare-result-success';
          resultDiv.textContent = data.result || '‚úÖ Kar≈üƒ±la≈ütƒ±rma tamamlandƒ± ama model bo≈ü d√∂nd√º.';
          if (data.warning) {
            resultDiv.textContent += `\n\n‚ö†Ô∏è Uyarƒ±: ${data.warning}`;
          }
        }

      } catch (error) {
        if (resultDiv) {
          resultDiv.className = 'compare-result-error';
          resultDiv.textContent = '‚ùå Hata: ' + error.message;
        }

      } finally {
        compareBtn.disabled = false;
        compareBtn.innerHTML = '<span>üöÄ</span><span>Kar≈üƒ±la≈ütƒ±r</span>';
      }
    });
  }

  // Ba≈ülangƒ±√ßta se√ßim sayacƒ±nƒ± g√ºncelle
  updateSelectionCounter();
  </script>
</body>
</html>